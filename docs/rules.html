<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Rules attributes - open-lmake documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">open-lmake documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- This file is part of the open-lmake distribution (git@github.com:cesar-douady/open-lmake.git)-->
<!-- Copyright (c) 2023-2025 Doliam-->
<!-- This program is free software: you can redistribute/modify under the terms of the GPL-v3 (https://www.gnu.org/licenses/gpl-3.0.html).-->
<!-- This program is distributed WITHOUT ANY WARRANTY, without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.-->
<h1 id="rule-attributes"><a class="header" href="#rule-attributes">Rule attributes</a></h1>
<p>Each attribute is characterized by a few flags:</p>
<ul>
<li>How inheritance is handled:
<ul>
<li>None: (ignore values from base classes)</li>
<li>python: (normal python processing)</li>
<li>Combine: (Combine inherited values and currently defined one).</li>
</ul>
</li>
<li>The type.</li>
<li>The default value.</li>
<li>Whether it can be defined dynamically from job to job:
<ul>
<li>No</li>
<li>Simple: globals include module globals, user attributes, stems and targets, no file access allowed.</li>
<li>Full:   globals include module globals, user attributes, stems, targets, deps and resources, file accesses become deps.</li>
</ul>
</li>
</ul>
<p>When targets are allowed in dynamic values, the <code>targets</code> variable is also defined as the <code>dict</code> of the targets.
Also, if <code>target</code> was used to redirect stdout, the <code>target</code> variable contains said file name.</p>
<p>Similarly, when deps are allowed in dynamic values, the <code>deps</code> variable is also defined as the <code>dict</code> of the deps.
Also, if <code>dep</code> was used to redirect stdin, the <code>dep</code> variable contains said file name.</p>
<p>When a type is mentioned as <code>f-str</code>, it means that although written as plain <code>str</code>, they are dynamically interpreted as python f-strings, as for dynamic values.
This is actually a form of dynamic value.</p>
<h1 id="dynamic-attribute-execution"><a class="header" href="#dynamic-attribute-execution">Dynamic attribute execution</a></h1>
<p>If the value of an attribute (other than <code>cmd</code>) is dynamic, it is interpreted within open-lmake, not as a separate process as for the execution of cmd.
This means:</p>
<ul>
<li>Such executions are not parallelized, this has a performance impact.</li>
<li>They are executed within a single python interpreter, this implies restrictions.</li>
</ul>
<p>Overall, these functions must be kept as simple and fast as possible, in favor of <code>cmd</code> which is meant to carry out heavy computations.</p>
<p>The restrictions are the following:</p>
<ul>
<li>The following system (or libc) calls are forbidden (trying to execute any of these results in an error):
<ul>
<li>changing dir (<code>chdir</code> and the like)</li>
<li>spawning processes (fork and the like)</li>
<li>exec (execve and the like)</li>
<li>modifying the disk (open for writing and the like)</li>
</ul>
</li>
<li>The environment variables cannot be tailored as is the case with cmd execution (there is no <code>environ</code> attribute as there is for <code>cmd</code>).</li>
<li>Modifying the environment variables (via setenv and the like) is forbidden (trying to execute any of these results in an error).</li>
<li>Altering imported modules is forbidden (e.g. it is forbidden to write to <code>sys.path</code>).
<ul>
<li>Unfortunately, this is not checked.</li>
<li><code>sys.path</code> is made  <code>tuple</code> though, so that common calls such as <code>sys.path.append</code> will generate an error.</li>
</ul>
</li>
<li><code>sys.path</code> is sampled after having read <code>Lmakefile.py</code> (while reading rules) and local dirs are filtered out. There are no means to import local modules.</li>
<li>However, reading local files is ok, as long as <code>sys.modules</code> is not updated.</li>
<li>There is no containers, as for <code>cmd</code> execution (e.g. no <code>repo_view</code>).</li>
<li>execution is performed in the top-level root dir.
<ul>
<li>This means that to be used as a sub-repo, all local file accesses must be performed with the sub-repo prefix.</li>
<li>This prefix can be found in <code>lmake.sub_repo</code>, which contains <code>.</code> for the top-level repo.</li>
</ul>
</li>
</ul>
<h2 id="attributes"><a class="header" href="#attributes">Attributes</a></h2>
<h3 id="auto_mkdir"><a class="header" href="#auto_mkdir"><a href="unit_tests/chdir.html#:~:text=auto%5Fmkdir%20%3D%20step%3D%3D2"><code>auto_mkdir</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>bool</code></td><td><code>False</code></td><td>Full</td><td><code>True</code></td></tr>
</tbody></table>
</div>
<p>When this attribute has a true value, executing a <code>chdir</code> syscall (e.g. executing <code>cd</code> in bash) will create the target dir if it does not exist.</p>
<p>This is useful for scripts in situations such as:</p>
<ul>
<li>The script does <code>chdir a</code>.</li>
<li>Then try to read file <code>b</code> from there.</li>
<li>What is expected is to have a dep on <code>a/b</code> which may not exist initially but will be created by some other job.</li>
<li>However, if dir <code>a</code> does not exist, the <code>chdir</code> call fails and the file which is open for reading is <code>b</code> instead of <code>a/b</code>.</li>
<li>As a consequence, no dep is set for <code>a/b</code> and the problem will not be resolved by a further re-execution.</li>
<li>Setting this attribute to true creates dir <code>a</code> on the fly when <code>chdir</code> is called so that it succeeds and the correct dep is set.</li>
</ul>
<h3 id="autodep"><a class="header" href="#autodep"><a href="unit_tests/ptrace.html#:~:text=autodep%20%3D%20%27ptrace"><code>autodep</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>f-str</code></td><td><code>'ld_audit'</code> if supported else <code>'ld_preload'</code></td><td>Full</td><td><code>'ptrace'</code></td></tr>
</tbody></table>
</div>
<p>This attribute specifies the method used by <a href="autodep.html">autodep</a> to discover hidden deps.</p>
<h3 id="backend"><a class="header" href="#backend"><a href="unit_tests/slurm.html#:~:text=backend%20%3D%20%27slurm"><code>backend</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>f-str</code></td><td>-</td><td>Full</td><td><code>'slurm'</code></td></tr>
</tbody></table>
</div>
<p>This attribute specifies the <a href="backends.html">backend</a> to use to launch jobs.</p>
<h3 id="cache"><a class="header" href="#cache"><a href="unit_tests/cache.html#:~:text=cache%20%3D%20%27my%5Fcache"><code>cache</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>f-str</code></td><td>-</td><td>Simple</td><td></td></tr>
</tbody></table>
</div>
<p>This attribute specifies the cache to use for jobs executed by this rule.</p>
<p>When a job is executed, its results are stored in the cache.
If space is needed (all caches are constrained in size), any other entry can be replaced.
The cache replacement policy (described in its own section, in the config chapter) tries to identify entries that are likely to be useless in the future.</p>
<h3 id="cmd"><a class="header" href="#cmd"><a href="unit_tests/basics.html#:~:text=class%20CatSh,f%2Eread%28%29%2Cend%3D%27%27%29"><code>cmd</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>Combined</td><td><code>f-str</code></td><td>-</td><td>Full</td><td><code>'gcc -c -o {OBJ} {SRC}'</code></td></tr>
<tr><td>Combined</td><td>function</td><td>-</td><td>Full</td><td><code>def cmd() : subprocess.run(('gcc','-c','-o',OBJ,SRC,check=True))</code></td></tr>
</tbody></table>
</div>
<h4 id="if-it-is-a-function"><a class="header" href="#if-it-is-a-function"><a href="unit_tests/basics.html#:~:text=def%20cmd%28%29%20%3A">if it is a function</a></a></h4>
<p>In that case, this attribute is called to run the job (cf. <a href="job_execution.html">job execution</a>).
Combined inheritance is a special case for <code>cmd</code>.</p>
<p>If several definitions exist along the MRO, They must all be functions and they are called successively in reverse MRO.
The first (i.e. the most basic) one must have no non-defaulted arguments and will be called with no argument.
The other ones may have arguments, all but the first having default values.
In that case, such <code>function</code>'s are called with the result of the previous one as unique argument.
Else, if a <code>function</code> has no argument, the result of the previous function is dropped.</p>
<p>Because jobs are executed remotely using the interpreter mentioned in the <code>python</code> attribute
and to avoid depending on the whole <code>Lmakefile.py</code> (which would force to rerun all jobs as soon as any rule is modified),
these functions and their context are serialized to be transported by value.
The serialization process may improve over time but as of today, the following applies:</p>
<ul>
<li>Basic objects are transported as is : <code>None</code>, <code>...</code>, <code>bool</code>, <code>int</code>, <code>float</code>, <code>complex</code>, <code>str</code>, <code>bytes</code>.</li>
<li><code>list</code>, <code>tuple</code>, <code>set</code> and <code>dict</code> are transported by transporting their content. Note that reconvergences (and a fortiori loops) are not handled.</li>
<li>functions are transported as their source accompanied with their context : global accessed variables and default values for arguments.</li>
<li>Imported objects (functions and <code>class</code>'es and generally all objects with a <code>__qualname__</code> attribute) are transported as an <code>import</code> statement.</li>
<li>Builtin objects are transported spontaneously, without requiring any generated code.</li>
</ul>
<p>Also, care has been taken to hide this transport by value in backtrace and during debug sessions, so that functions appear to be executed where they were originally defined.</p>
<p>Values are captured according to the normal python semantic, i.e. once the <code>Lmakefile</code> module is fully imported.
Care must be taken for variables whose values change during the <code>import</code> process.
This typically concerns loop indices.
To capture these at definition time and not at the end, such values must be saved somewhere.
There are mostly 2 practical possibilities:</p>
<ul>
<li>Declare an argument with a default value. Such default value is saved when the function is defined.</li>
<li>Define a class attribute. Class attributes are saved when its definition ends, which is before a loop index.</li>
</ul>
<h4 id="if-it-is-a-f-str"><a class="header" href="#if-it-is-a-f-str"><a href="unit_tests/basics.html#:~:text=%27cat%20%7BFIRST%7D%20%7BSECOND%7D%27">if it is a <code>f-str</code></a></a></h4>
<p>In that case, this attribute is executed as a shell command to run the job (cf. <a href="job_execution.html">job execution</a>).
Combined inheritance is a special case for <code>cmd</code>.</p>
<p>While walking the MRO, if for a base class <code>cmd</code> is defined as a function and it has a <code>shell</code> attribute, the value of this attribute is used instead.
The purpose is that it is impossible to combine <code>str</code>'s and functions because they use different paradigms.
As a consequence, a base class may want to have 2 implementations, one for subclasses that use python <code>cmd</code> and another for subclasses that use shell <code>cmd</code>.
For such a base class, the solution is to define <code>cmd</code> as a function and set its <code>shell</code> attribute to the <code>str</code> version.</p>
<p>If several definitions exist along the MRO, They must all be <code>str</code>'s and they are run successively in reverse MRO in the same process.
So, it is possible for a first definition to define an environment variable that is used in a subsequent one.</p>
<p>As for other attributes that may be dynamic, <code>cmd</code> is interpreted as an f-string.</p>
<h3 id="chroot_dir"><a class="header" href="#chroot_dir"><a href="unit_tests/chroot.html#:~:text=chroot%5Fdir%20%3D%20%27%7Bimage%5Froot%28Os%29%7D%27"><code>chroot_dir</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>f-str</code></td><td><code>None</code></td><td>Full</td><td><code>'/ubuntu22.04'</code></td></tr>
</tbody></table>
</div>
<p>This attribute defines a dir in which jobs will <code>chroot</code> into before execution begins.
It must be an absoluted path.</p>
<p>Note that unless the <code>repo_view</code> is set, the repo must be visible under its original name in this chroot environment.</p>
<p>If <code>None</code>, <code>''</code> or <code>'/'</code>, no <code>chroot</code> is performed unless required to manage the <code>tmp_view</code> and <code>repo_view</code> attributes (in which case it is transparent).
However, if <code>'/'</code>, <a href="namespaces.html">namespaces</a> are used nonetheless.</p>
<p>This attribute is typically used to execute the job in a different environment, such as a different OS distribution or release, leveraging a <code>docker</code> image.</p>
<h3 id="compression"><a class="header" href="#compression"><a href="unit_tests/cache.html#:~:text=compression%20%3D%20z%5Flvl,-cmd%20%3D%20%27%27%27%20dir"><code>compression</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>None</code> or <code>str</code> or <code>int</code> or <code>tuple</code> or <code>list</code></td><td>None</td><td>Full</td><td><code>1</code></td></tr>
</tbody></table>
</div>
<p>This attribute specifies the compression used when caching.</p>
<ul>
<li>if <code>None</code>       , no compression occurs.</li>
<li>If it is a <code>str</code>, it specifies the method and can be <code>'zstd'</code> or <code>'zlib'</code>, and the level defaults to 1.</li>
<li>If it is a <code>int</code>, it specifies the compression level: from <code>0</code> which means no compression to <code>9</code> which means best (and slowest) compression.
The method defaults to <code>'zstd'</code> if supported, else to <code>'zlib'</code>.
Note that <code>1</code> seems to be a good compromize.</li>
<li>If a <code>tuple</code> or a <code>list</code>, it specifies both a method and a level (in that order).</li>
</ul>
<p>When downloading from cache, the method and level used at upload time is honored.
If the compression method is not supported, no download occurs.</p>
<h3 id="dep"><a class="header" href="#dep"><a href="unit_tests/back_ref.html#:~:text=dep%20%3D%20%27single1%2Bdep%2Bdouble%2Bsingle2%2Bdouble%2Bdep"><code>dep</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>str</code> or <code>list</code> or <code>tuple</code></td><td>-</td><td>Simple</td><td></td></tr>
</tbody></table>
</div>
<p>This attribute defines an unnamed static dep.</p>
<p>During execution, <code>cmd</code> stdin will be redirected to this dep, else it is <code>/dev/null</code>.</p>
<h3 id="deps"><a class="header" href="#deps"><a href="unit_tests/chain.html#:~:text=deps%20%3D%20%7B%20%27FIRST%27%20%3A%20%27%7BFile1%7D%27%20%2C%20%27SECOND%27%20%3A%20%27%7BFile2%7D%27%20%7D"><code>deps</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>Combined</td><td><code>dict</code></td><td><code>{}</code></td><td>Simple</td><td><code>{ 'SRC' : '{File}.c' }</code></td></tr>
</tbody></table>
</div>
<p>This attribute defines the static deps.
It is a <code>dict</code> which associates python identifiers to files computed from the available environment.</p>
<p>They are f-strings, i.e. their value follow the python f-string syntax and semantic
but they are interpreted when open-lmake tries to match the rule (the rule only matches if static deps are buildable, cf. <a href="rule_selection.html">rule selection</a>).
Hence they lack the initial <code>f</code> in front of the string.</p>
<p>Alternatively, values can also be <code>list</code> or <code>tuple</code> whose first item is as described above, followed by flags.</p>
<p>The flags may be any combination of the following flags, optionally preceded by - to turn it off.
Flags may be arbitrarily nested into sub-<code>list</code>'s or sub-<code>tuple</code>'s.</p>
<div class="table-wrapper"><table><thead><tr><th>CamelCase</th><th>snake_case</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>Essential</code></td><td><code>essential</code></td><td>Yes</td><td>This dep will be shown in a future graphic tool to show the workflow, it has no algorithmic effect.</td></tr>
<tr><td><code>Critical</code></td><td><code>critical</code></td><td>No</td><td>This dep is <a href="critical_deps.html">critical</a>.</td></tr>
<tr><td><code>IgnoreError</code></td><td><code>ignore_error</code></td><td>No</td><td>This dep may be in error, job will be launched anyway.</td></tr>
<tr><td><code>ReaddirOk</code></td><td><code>readdir_ok</code></td><td>No</td><td>This dep may be read as a dir (using <code>readdir</code> (3)) without error.</td></tr>
<tr><td><code>Required</code></td><td><code>required</code></td><td>No</td><td>This dep is deemed to be read, even if not actually read by the job.</td></tr>
<tr><td><code>NoStar</code></td><td><code>no_star</code></td><td>Yes</td><td>Accept regexpr-based flags (e.g. from star <code>side_deps</code> or <code>side_targets</code>)</td></tr>
<tr><td><code>Top</code></td><td><code>top</code></td><td>No</td><td>Dep pattern is interpreted relative to the top-level repo, else to the local repo (cf. <a href="experimental_subrepos.html">subrepos</a>.</td></tr>
</tbody></table>
</div>
<p>Flag order and dep order are not significative.</p>
<p>Usage notes:</p>
<ul>
<li>The  <code>critical</code> flag is typically used for deps that contain a list of deps, for example for a test suite.
In that case, if the list changes, speculatively building the old deps is probably not the best strategy.</li>
<li>The <code>ignore_error</code> flag is also typically use for test suites to generate a colored report.</li>
<li>The <code>-no_star</code> flag is used to avoid repetition, as it is generally possible to mention all the flags that must apply to a target,
possibly duplicating flags mentioned in other matching entries (<code>side_deps</code> and <code>side_targets</code>).</li>
<li>The <code>top</code> flag is used in case of sub-repo, which is an experimental feature.</li>
</ul>
<h3 id="environ"><a class="header" href="#environ"><a href="unit_tests/env.html#:~:text=environ%20%3D%20%7B%20%27FROM%5FBACKEND%27%20%3A%20%2E%2E%2E%20%2C%20%27FROM%5FRULE%27%20%3A%20%27from%5Frule%27%20%7D"><code>environ</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>Combined</td><td><code>dict</code></td><td>...</td><td>Full</td><td><code>{ 'MY_TOOL_ROOT' : '/install/my_tool' }</code></td></tr>
</tbody></table>
</div>
<p>This attribute defines environment variables set during job execution.</p>
<p>The content of this attribute is managed as part of the job command, meaning that jobs are rerun upon modification.
This is the normal behavior, other means to define environment are there to manage special situations.</p>
<p>The environment in which the open-lmake command is run is ignored so as to favor reproducibility, unless explicitly transported by using value from <code>lmake.user_environ</code>.
Hence, it is quite simple to copy some variables from the user environment although this practice is discouraged and should be used with much care.</p>
<p>Except the exception below, the value must be a <code>f-str</code>.</p>
<p>If resulting value is <code>...</code> (the python ellipsis), the value from the backend environment is used.
This is typically used to access some environment variables set by <code>slurm</code>.</p>
<p>If a value contains one of the following strings, they are replaced by their corresponding definitions:</p>
<div class="table-wrapper"><table><thead><tr><th>Key</th><th>Replacement</th><th>Comment</th></tr></thead><tbody>
<tr><td><code>$LMAKE_ROOT</code></td><td>The root dir of the open-lmake package</td><td>Dont store in targets as this may require cleaning repo if open-lmake installation changes</td></tr>
<tr><td><code>$PHYSICAL_REPO_ROOT</code></td><td>The physical dir of the subrepo</td><td>Dont store in targets as this may interact with cached results</td></tr>
<tr><td><code>$PHYSICAL_TMPDIR</code></td><td>The physical dir of the tmp dir</td><td>Dont store in targets as this may interact with cached results</td></tr>
<tr><td><code>$PHYSICAL_TOP_REPO_ROOT</code></td><td>The physical dir of the top-level repo</td><td>Dont store in targets as this may interact with cached results</td></tr>
<tr><td><code>$REPO_ROOT</code></td><td>The absolute dir of the subrepo as seen by job</td><td></td></tr>
<tr><td><code>$SEQUENCE_ID</code></td><td>A unique value for each job execution (at least 1)</td><td>This value must be semantically considered as a random value</td></tr>
<tr><td><code>$SMALL_ID</code></td><td>A unique value among simultaneously running jobs (at least 1)</td><td>This value must be semantically considered as a random value</td></tr>
<tr><td><code>$TMPDIR</code></td><td>The absolute dir of the tmp dir, as seen by the job</td><td></td></tr>
<tr><td><code>$TOP_REPO_ROOT</code></td><td>The absolute dir of the top-level repo, as seen by the job</td><td></td></tr>
</tbody></table>
</div>
<p>By default the following environment variables are defined :</p>
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Defined in</th><th>Value</th><th>comment</th></tr></thead><tbody>
<tr><td><code>$HOME</code></td><td>Rule</td><td><code>$TOP_REPO_ROOT</code></td><td>See above, isolates tools startup from user specific data</td></tr>
<tr><td><code>$HOME</code></td><td>HomelessRule</td><td><code>$TMPDIR</code></td><td>See above, pretend tools are used for the first time</td></tr>
<tr><td><code>$PATH</code></td><td>Rule</td><td>The standard path with <code>$LMAKE_ROOT/bin:</code> in front</td><td></td></tr>
<tr><td><code>$PYTHONPATH</code></td><td>PyRule</td><td><code>$LMAKE_ROOT/lib</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="environ_ancillary"><a class="header" href="#environ_ancillary"><a href="unit_tests/dyn.html#:~:text=environ%5Fancillary%20%3D%20%7B%20%27VAR%5FANCILLARY%27%20%3A%20file%5Ffunc%20%7D"><code>environ_ancillary</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>Combined</td><td><code>dict</code></td><td><code>{}</code></td><td>Full</td><td><code>{ 'DISPLAY' : ':10' }</code></td></tr>
</tbody></table>
</div>
<p>This attribute defines environment variables set during job execution.</p>
<p>The content of this attribute is not managed, meaning that jobs are not rerun upon modification.</p>
<p>The values undertake the same substitutions as for the <code>environ</code> attribute described above.</p>
<p>The environment in which the open-lmake command is run is ignored so as to favor reproducibility, unless explicitly transported by using value from <code>lmake.user_environ</code>.
Hence, it is quite simple to copy some variables from the user environment although this practice is discouraged and should be used with much care.</p>
<p>Except the exception below, the value must be a <code>f-str</code>.</p>
<p>If resulting value is <code>...</code> (the python ellipsis), the value from the backend environment is used.
This is typically used to access some environment variables set by <code>slurm</code>.</p>
<p>By default the following environment variables are defined :</p>
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Defined in</th><th>Value</th><th>comment</th></tr></thead><tbody>
<tr><td><code>$UID</code></td><td>Rule</td><td>the user id</td><td></td></tr>
<tr><td><code>$USER</code></td><td>Rule</td><td>the user login name</td><td></td></tr>
</tbody></table>
</div>
<h3 id="environ_resources"><a class="header" href="#environ_resources"><a href="unit_tests/dyn.html#:~:text=environ%5Fresources%20%3D%20%7B%20%27VAR%5FRESOURCES%27%20%3A%20file%5Ffunc%20%7D"><code>environ_resources</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>Combined</td><td><code>dict</code></td><td><code>{}</code></td><td>Full</td><td><code>{ 'MY_TOOL_LICENCE' : '12345' }</code></td></tr>
</tbody></table>
</div>
<p>This attribute defines environment variables set during job execution.</p>
<p>The content of this attribute is managed as resources, meaning that jobs in error are rerun upon modification, but not jobs that were successfully built.</p>
<p>The values undertake the same substitutions as for the <code>environ</code> attribute described above.</p>
<p>The environment in which the open-lmake command is run is ignored so as to favor reproducibility, unless explicitly transported by using value from <code>lmake.user_environ</code>.
Hence, it is quite simple to copy some variables from the user environment although this practice is discouraged and should be used with much care.</p>
<p>Except the exception below, the value must be a <code>f-str</code>.</p>
<p>If resulting value is <code>...</code> (the python ellipsis), the value from the backend environment is used.
This is typically used to access some environment variables set by <code>slurm</code>.</p>
<h3 id="force"><a class="header" href="#force"><a href="unit_tests/dyn.html#:~:text=force%20%3D%20True"><code>force</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>bool</code></td><td><code>False</code></td><td>Full</td><td><code>True</code></td></tr>
</tbody></table>
</div>
<p>When this attribute is set to a true value, jobs are always considered out-of-date and are systematically rerun if a target is needed.
It is rarely necessary.</p>
<h3 id="job_name"><a class="header" href="#job_name"><code>job_name</code></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>str</code></td><td>...</td><td>No</td><td></td></tr>
</tbody></table>
</div>
<p>Default is the first target of the most derived <code>class</code> in the inheritance hierarchy (i.e. the MRO) having a matching target.</p>
<p>This attribute may exceptionally be used for cosmetic purpose.
Its syntax is the same as target name (i.e. a target with no option).</p>
<p>When open-lmake needs to include a job in a report, it will use this attribute.
If it contains star stems, they will be replaced by <code>*</code>'s in the report.</p>
<p>If defined, this attribute must have the same set of static stems (i.e. stems that do not contain <code>*</code>) as any matching target.</p>
<h3 id="keep_tmp"><a class="header" href="#keep_tmp"><code>keep_tmp</code></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>bool</code></td><td><code>False</code></td><td>Full</td><td><code>True</code></td></tr>
</tbody></table>
</div>
<p>When this attribute is set to a true value, the temporary dir is kept after job execution.
It can be retreived with <code>lshow -i</code>.</p>
<p>Sucessive executions of the same job overwrite the temporary dir, though, so only the content corresponding to the last execution is available.
When this attribute has a false value, the temporary dir is cleaned up at the end of the job execution.</p>
<h3 id="kill_sigs"><a class="header" href="#kill_sigs"><a href="unit_tests/kill.html#:~:text=kill%5Fsigs%20%3D%20%282%2C%29%20%23%20SIGKILL%20%289%29%20is%20automatically%20added%20when%20list%20is%20exhausted"><code>kill_sigs</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>list</code> or <code>tuple</code></td><td><code>(signal.SIGKILL,)</code></td><td>Full</td><td></td></tr>
</tbody></table>
</div>
<p>This attribute provides a list of signals to send the job when @lmake decides to kill it.</p>
<p>A job is killed when:</p>
<ul>
<li><code>^C</code> is hit if it is not necessary for another running <code>lmake</code> command that has not received a <code>^C</code>.</li>
<li>When timeout is reached.</li>
<li>When <code>check_deps</code> is called and some deps are out-of-date.</li>
</ul>
<p>The signals listed in this list are sent in turn, once every second.
Longer interval can be obtained by inserting <code>0</code>'s. <code>0</code> signals are not sent and anyway, these would have no impact if they were.</p>
<p>If the list is exhausted and the job is still alive, a more agressive method is used.
The process group of the job, as well as the process group of any process connected to a stream we are waiting for, are sent <code>SIGKILL</code> signals instead of just the process group of the job.
The streams we are waiting for are <code>stderr</code>, and <code>stdout</code> unless the <code>target</code> attribute is used (as opposed to the <code>targets</code> attribute)
in which case <code>stdout</code> is redirected to the the target and is not waited for.</p>
<p>Note: some backends, such as slurm, may have other means to manage timeouts. Both mechanisms will be usable.</p>
<h3 id="lmake_root"><a class="header" href="#lmake_root"><a href="unit_tests/chroot.html#:~:text=lmake%5Froot%20%3D%20%27%7Blmake%5Finstall%5Froot%28Os%29%7D%27"><code>lmake_root</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>f-str</code></td><td><code>None</code></td><td>Full</td><td><code>'/installs/lmake'</code></td></tr>
</tbody></table>
</div>
<p>This attribute defines the open-lmake installation directory the job will use.
It must be an absoluted path.
If used in conjunction with <code>chroot_dir</code>, the directory is searched in the chroot dir first, then, if not found, in the native root.</p>
<p>If <code>None</code> or <code>''</code> the current installation is used.</p>
<p>This attribute is typically used in conjunction with <code>chroot_dir</code> to indicate the installation dir of a suitable open-lmake.</p>
<h3 id="lmake_view"><a class="header" href="#lmake_view"><a href="unit_tests/namespaces.html#:~:text=lmake%5Fview%20%3D%20%27%2F%27%2Blmake%5Fview"><code>lmake_view</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>f-str</code></td><td><code>None</code></td><td>Full</td><td><code>'/lmake'</code></td></tr>
</tbody></table>
</div>
<p>This attribute defines a dir in which jobs will see the top-level dir of open-lmake installation.
This is done by using <code>mount -rbind</code> (cf. <a href="namespaces.html">namespaces</a>) before any chroot if asked to do so.</p>
<p>It must be an absolute path not lying in the temporary dir.</p>
<p>If <code>None</code>, <code>''</code> or not specified, this dir is not mounted, else, it must be an absolute path.
If it already exists, it must be a (preferably empty) dir, else it must be a top-level name (e.g <code>/a</code> but not <code>/a/b</code>).</p>
<h3 id="max_retries_on_lost"><a class="header" href="#max_retries_on_lost"><code>max_retries_on_lost</code></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>int</code></td><td><code>1</code></td><td>No</td><td></td></tr>
</tbody></table>
</div>
<p>This attribute provides the number of allowed retries before giving up when a job is lost.
For example, a job may be lost because of a remote host being misconfigured, or because the job management process (called <code>job_exec</code>) was manually killed.</p>
<p>In that case, the job is retried, but a maximum number of retry attemps are allowed, after which the job is considered in error.</p>
<h3 id="max_runs"><a class="header" href="#max_runs"><a href="unit_tests/stress_codec.html#:~:text=max%5Fruns%20%3D%202"><code>max_runs</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>int</code></td><td><code>0</code></td><td>No</td><td></td></tr>
</tbody></table>
</div>
<p>The goal is to protect against potential loss of performances if reruns are too frequent.
Unlimited if <code>0</code>.
Contrarily to the <code>max_submits</code> attribute, cache accesses are not counted when counting runs.</p>
<h3 id="max_stderr_len"><a class="header" href="#max_stderr_len"><a href="unit_tests/dyn.html#:~:text=def%20max%5Fstderr%5Flen%28%29%20%3A%20if%20step%3D%3D1%20%3A%20raise%20RuntimeError%20return%20File"><code>max_stderr_len</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>int</code></td><td><code>100</code></td><td>Full</td><td><code>1</code></td></tr>
</tbody></table>
</div>
<p>This attribute defines the maximum number of lines of stderr that will be displayed in the output of <code>lmake</code>.
The whole content of stderr stays accessible with the <code>lshow -e</code> command.</p>
<h3 id="max_submits"><a class="header" href="#max_submits"><a href="unit_tests/misc6.html#:~:text=max%5Fsubmits%20%3D%201"><code>max_submits</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>int</code></td><td><code>10</code></td><td>No</td><td></td></tr>
</tbody></table>
</div>
<p>The goal is to protect agains potential infinite loop cases.
The default value should be both comfortable (avoid hitting it in normal situations) and practical (avoid too many submissions before stopping).
Unlimited if <code>0</code>.
Contrarily to the <code>max_runs</code> attribute, cache accesses are counted when counting submits.</p>
<h3 id="name"><a class="header" href="#name"><a href="unit_tests/name.html#:~:text=name%20%3D%20f%27expand%7Bstep%7D%27"><code>name</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>None</td><td><code>str</code></td><td><code>cls.__name__</code></td><td>No</td><td></td></tr>
</tbody></table>
</div>
<p>This attribute specify a name for the rule.
This name is used each time open-lmake needs to mention the rule in a message.</p>
<p>All rules must have a unique name.
Usually, the default value is fine, but you may need to set a name, for example:</p>
<pre><code class="language-python">for ext in ('c','cc'):
	class Compile(Rule):
		name    = f'compile {ext}'
		targets = { 'OBJ' : '{File:.*}.o' }
		deps    = { 'SRC' : f'{{File}}.{ext}' }
		cmd     = 'gcc -c -o {OBJ} {SRC}'
</code></pre>
<h3 id="os_info"><a class="header" href="#os_info"><a href="unit_tests/os_info.html#:~:text=os%5Finfo%20%3D%20%27go%2Bd%5Cn%27"><code>os_info</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>f-str</code></td><td>re.escape(<code>&lt;ID&gt;/&lt;VERSION_ID&gt;/&lt;machine&gt;</code>)</td><td>Full</td><td><code>r'ubuntu/22\.04/x86_64'</code></td></tr>
</tbody></table>
</div>
<p>This attribute specifies a regexpr characterizing if the OS environment in which jobs execute are acceptable.
When a job starts, the same information is computed on the executing host and the value must match this regexpr.</p>
<p>In the default value above, <code>&lt;ID&gt;</code> and <code>&lt;VERSION_ID&gt;</code> are taken from the corresponding lines in <code>/etc/os-release</code> and <code>&lt;machine&gt;</code> is <code>os.uname().machine</code>.</p>
<p>If <code>None</code> or <code>''</code> no check is performed.</p>
<p>This attribute is typically used jobs are executed in various OS environment, for example when using the <code>chroot_dir</code> attribute or when jobs are dispatched using slurm or SGE.</p>
<h3 id="os_info_file"><a class="header" href="#os_info_file"><a href="unit_tests/os_info.html#:~:text=os%5Finfo%5Ffile%20%3D%20os%2Egetcwd%28%29%2B%27%2FLMAKE%2Flmake%2Fos%5Finfo"><code>os_info_file</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>f-str</code></td><td><code>''</code></td><td>Full</td><td><code>'/my_os_tag'</code></td></tr>
</tbody></table>
</div>
<p>This attribute specifies a file from which to get OS information for use with the <code>os_info</code> attribute above.
When specified, the content of this file is used instead of <code>&lt;ID&gt;/&lt;VERSION_ID&gt;/&lt;machine&gt;</code> as described above.</p>
<h3 id="prio"><a class="header" href="#prio"><a href="unit_tests/hide.html#:~:text=prio%20%3D%201"><code>prio</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>float</code></td><td><code>0</code> or <code>+inf</code></td><td>No</td><td><code>1</code></td></tr>
</tbody></table>
</div>
<p>Default value is 0 if inheriting from <code>lmake.Rule</code>, else <code>+inf</code>.</p>
<p>This attribute is used to order matching priority.
Rules with higher priorities are tried first and if none of them are applicable, rules with lower priorities are then tried (cf. <a href="rule_selection.html">rule selection</a>).</p>
<h3 id="python"><a class="header" href="#python"><a href="unit_tests/python2.html#:~:text=python%20%3D%20%28lmake%2Euser%5Fenviron%5B%27PYTHON2%27%5D%2C%29"><code>python</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>list</code> or <code>tuple</code></td><td>system python</td><td>Full</td><td><code>venv/bin/python3</code></td></tr>
</tbody></table>
</div>
<p>This attribute defines the interpreter used to run the <code>cmd</code> if it is a function.</p>
<p>Items must be <code>f-str</code>.</p>
<p>At the end of the supplied executable and arguments, <code>'-c'</code> and the actual script is appended, unless the <code>use_script</code> attribut is set.
In the latter case, a file that contains the script is created and its name is passed as the last argument without a preceding <code>-c</code>.</p>
<p>Open-lmake uses python3.6+ to read <code>Lmakefile.py</code>, but that being done, any interpreter can be used to execute <code>cmd</code>.
In particular, python2.7 and all revisions of python3 are fully supported.</p>
<p>If simple enough (i.e. if it can be recognized as a static dep), it is made a static dep if it is within the repo.</p>
<h3 id="readdir_ok"><a class="header" href="#readdir_ok"><a href="unit_tests/wine.html#:~:text=readdir%5Fok%20%3D%20True"><code>readdir_ok</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>bool</code></td><td><code>False</code></td><td>Full</td><td><code>True</code></td></tr>
</tbody></table>
</div>
<p>When this attribute has a false value, reading a local dir that is not <code>ignore</code>d nor <code>incremental</code> is considered an error as the list of files in a dir cannot be made stable,
i.e. independent of the history (the repo is not constantly maintained without spurious files, nor with all buildable files existing).</p>
<p>If it is true, such reading is allowed and it is the user responsibility to ensure that spurious or missing files have no impact on output, once all deps are up-to-date.</p>
<h3 id="repo_view"><a class="header" href="#repo_view"><a href="unit_tests/namespaces.html#:~:text=repo%5Fview%20%3D%20%27%2F%27%2Brepo%5Fview"><code>repo_view</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>f-str</code></td><td><code>None</code></td><td>Full</td><td><code>'/repo'</code></td></tr>
</tbody></table>
</div>
<p>This attribute defines a dir in which jobs will see the top-level dir of the repo (the root dir).
This is done by using <code>mount -rbind</code> (cf. <a href="namespaces.html">namespaces</a>) before any chroot if asked to do so.</p>
<p>It must be an absolute path not lying in the temporary dir.</p>
<p>If <code>None</code>, <code>''</code> or not specified, this dir is not mounted, else, it must be an absolute path.
If it already exists, it must be a (preferably empty) dir, else it must be a top-level name (e.g <code>/a</code> but not <code>/a/b</code>).</p>
<p>This attribute is typically used when using tools that handle absolute paths.
This allows such jobs to be repeatable independently of the location of the repo, making for example caching possible.</p>
<h3 id="resources"><a class="header" href="#resources"><a href="unit_tests/resources.html#:~:text=resources%20%3D%20%7B%20%27gnat%27%3A%20%271%27%20%7D"><code>resources</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>Combined</td><td><code>dict</code></td><td><code>{}</code></td><td>Full</td><td><code>{ 'MY_RESOURCE' : '1' }</code></td></tr>
</tbody></table>
</div>
<p>This attribute specifies the resources required by a job to run successfully.
These may be cpu availability, memory, commercial tool licenses, access to dedicated hardware, ...</p>
<p>Values must <code>f-str</code>.</p>
<p>The syntax is the same as for <code>deps</code>.</p>
<p>After interpretation, the <code>dict</code> is passed to the <code>backend</code> to be used in its scheduling (cf. <a href="config.html">local backend</a> for the local backend).</p>
<h3 id="shell"><a class="header" href="#shell"><a href="unit_tests/misc19.html#:~:text=shell%20%3D%20Rule%2Eshell%20%2B%20%28%27%2De%27%2C%29"><code>shell</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>list</code> or <code>tuple</code></td><td><code>/bin/bash</code></td><td>Full</td><td><code>('/bin/bash','-e')</code></td></tr>
</tbody></table>
</div>
<p>This attribute defines the interpreter used to run the <code>cmd</code> if it is a <code>str</code>.</p>
<p>Items must be <code>f-str</code>.</p>
<p>At the end of the supplied executable and arguments, <code>'-c'</code> and the actual script is appended, unless the <code>use_script</code> attribut is set.
In the latter case, a file that contains the script is created and its name is passed as the last argument without a preceding <code>-c</code>.</p>
<p>If simple enough (i.e. if it can be recognized as a static dep), it is made a static dep if it is within the repo.</p>
<h3 id="side_deps"><a class="header" href="#side_deps"><a href="unit_tests/ignore.html#:~:text=side%5Fdeps%20%3D%20%7B%20%27BAD%27%20%3A%20%28%27bad%5Fdep%27%2C%27ignore%27%29%20%7D"><code>side_deps</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>Combined</td><td><code>dict</code></td><td><code>{}</code></td><td>No</td><td></td></tr>
</tbody></table>
</div>
<p>This attribute is used to define flags to deps when they are acquired during job execution.
It does not declare any dep by itself.
Syntactically, it follows the <code>side_targets</code> attribute except that:</p>
<ul>
<li>Specified flags are dep flags only where <code>side_targets</code> accept both target flags an dep flags.</li>
<li>The flag <code>Ignore</code> or <code>ignore</code> only applies to reads to prevent such accessed files from becoming a dep where for <code>side_targets</code>, this flag prevents files from being deps or targets.</li>
<li><code>.</code> may be specified as pattern (or pattern may include it as a possible match) which may be necessary when passing the <code>readdir_ok</code> flag.</li>
</ul>
<h3 id="side_targets"><a class="header" href="#side_targets"><a href="unit_tests/ignore.html#:~:text=side%5Ftargets%20%3D%20%7B%20%27BAD%27%20%3A%20%28%27bad%5Ftarget%27%2C%27ignore%27%29%20%7D"><code>side_targets</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>Combined</td><td><code>dict</code></td><td><code>{}</code></td><td>No</td><td></td></tr>
</tbody></table>
</div>
<p>This attribute is identical to <code>targets</code> except that:</p>
<ul>
<li>Targets listed here do not trigger job execution, i.e. they do not participate to the <a href="rule_selection.html">rule selection</a> process.</li>
<li>It not compulsory to use all static stems as this constraint is only necessary to fully define a job when selected by the rule selection process.</li>
</ul>
<h3 id="start_delay"><a class="header" href="#start_delay"><a href="unit_tests/misc10.html#:~:text=start%5Fdelay%20%3D%200"><code>start_delay</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>float</code></td><td><code>3</code></td><td>Full</td><td></td></tr>
</tbody></table>
</div>
<p>When this attribute is set to a non-zero value, start lines are only output for jobs that last longer than that many seconds.
The consequence is only cosmetic, it has no other impact.</p>
<h3 id="stderr_ok"><a class="header" href="#stderr_ok"><a href="unit_tests/misc1.html#:~:text=stderr%5Fok%20%3D%20True"><code>stderr_ok</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>bool</code></td><td><code>False</code></td><td>Full</td><td><code>True</code></td></tr>
</tbody></table>
</div>
<p>When this attribute has a false value, the simple fact that a job generates a non-empty stderr is an error.
If it is true, writing to stderr is allowed and does not produce an error. The <code>lmake</code> output will exhibit a warning, though.</p>
<h3 id="stems"><a class="header" href="#stems"><a href="unit_tests/basics.html#:~:text=stems%20%3D%20%7B%20%27File1%27%20%3A%20r%27%2E%2A%27%20%2C%20%27File2%27%20%3A%20r%27%2E%2A%27%20%7D"><code>stems</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>Combined</td><td><code>dict</code></td><td><code>{}</code></td><td>No</td><td><code>{'File':r'.*'}</code></td></tr>
</tbody></table>
</div>
<p>Stems are regular expressions that represent the variable parts of targets which rules match.</p>
<p>Each entry <key>:<value> define a stem named <key> whose associated regular expression is <value>.</p>
<h3 id="target"><a class="header" href="#target"><a href="unit_tests/basics.html#:~:text=target%20%3D%20%27%7BFile1%7D%2B%7BFile2%7D%5Fsh"><code>target</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>str</code> or <code>list</code> or <code>tuple</code></td><td>-</td><td>No</td><td></td></tr>
</tbody></table>
</div>
<p>This attribute defines an unnamed target.
Its syntax is the same as any target entry except that it may not be <code>incremental</code>. Also, such a target may not be a <code>star</code> target.</p>
<p>During execution, <code>cmd</code> stdout will be redirected to this (necessarily unique since it cannot be a <code>star</code>) target.</p>
<p>The <code>top</code> flag cannot be used and the pattern is always rooted to the sub-repo if the rule is defined in such a sub-repo.</p>
<h3 id="targets"><a class="header" href="#targets"><a href="unit_tests/misc14.html#:~:text=targets%20%3D%20%7B%20%27DUT%27%20%3A%20r%27dut%5Fsh%7BN%2A%3A%5Cd%7D%27%20%7D"><code>targets</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>Combined</td><td><code>dict</code></td><td><code>{}</code></td><td>No</td><td><code>{ 'OBJ' : '{File}.o' }</code></td></tr>
</tbody></table>
</div>
<p>This attribute is used to define the regular expression which targets must match to select this rule (cf. <a href="rule_selection.html">rule selection</a>).</p>
<p>Keys must be python identifiers.
Values are <code>list</code>'s or <code>tuple</code>'s whose first item defines the target regular expression and following items define flags.
They may also be a simple <code>str</code> in which case it is as if there were no associated flags.</p>
<p>The regular expression looks like python f-strings.
The fixed parts (outside <code>{}</code>) must match exactly.
The variable parts, called stems, are composed of:</p>
<ul>
<li>An optional name.
If it exists, it is used to ensure coherence with other targets and the <code>job_name</code> attribute, else coherence is ensured by position.
This name is used to find its definition in the stems <code>dict</code> and may also be used in the <code>cmd</code> attribute to refer to the actual content of the corresponding part in the target.</li>
<li>An optional <code>*</code>.
If it exists, this target is a star target, meaning that a single job will generate all or some of the targets matching this regular expression.
if not named, such stem must be defined.</li>
<li>An optional <code>:</code> followed by a definition (a regular expression).
This is an alternative to refering to an entry in the <code>stems</code> <code>dict</code>.
Overall, all stems must be defined somewhere (in the <code>stems</code> <code>dict</code>, in a target or in <code>job_name</code>) and if defined several times, definitions must be identical.
Also, when defined in a target, a definition must contain balanced <code>{}</code>'s, i.e. there must be as many <code>{</code> as <code>}</code>.
If a regular expression requires unbalanced <code>{}</code>, it must be put in a <code>stems</code> entry.</li>
</ul>
<p>Regular expressions are used with the <code>DOTALL</code> flag, i.e. a <code>.</code> matches any character, including <code>\n</code>.</p>
<p>The flags may be any combination of the following flags, optionally preceded by - to turn it off.
Flags may be arbitrarily nested into sub-<code>list</code>'s or sub-<code>tuple</code>'s.</p>
<div class="table-wrapper"><table><thead><tr><th>CamelCase</th><th>snake_case</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>Essential</code></td><td><code>essential</code></td><td>Yes</td><td>This target will be shown in a future graphic tool to show the workflow, it has no algorithmic effect.</td></tr>
<tr><td><code>Incremental</code></td><td><code>incremental</code></td><td>No</td><td>Previous content may be used to produce these targets.  Cf note (1).</td></tr>
<tr><td><code>Optional</code></td><td><code>optional</code></td><td>No</td><td>If this target is not generated, it is not deemed to be produced by the job. Cf note (2).</td></tr>
<tr><td><code>Phony</code></td><td><code>phony</code></td><td>No</td><td>Accept that this target is not generated, in which case it is deemed generated even not physically on disk. Cf note (3).</td></tr>
<tr><td><code>SourceOk</code></td><td><code>source_ok</code></td><td>No</td><td>Do not generate an error if target is actually a source</td></tr>
<tr><td><code>NoStar</code></td><td><code>no_star</code></td><td>Yes</td><td>Accept regexpr-based flags (e.g. from star <code>side_deps</code> or <code>side_targets</code>)</td></tr>
<tr><td><code>NoWarning</code></td><td><code>no_warning</code></td><td>No</td><td>Warning is not reported if a target is either uniquified or unlinked before job execution while generated by another job.</td></tr>
<tr><td><code>Top</code></td><td><code>top</code></td><td>No</td><td>Target pattern is interpreted relative to the root dir of the repo, else it is relative to the <code>cwd</code> of the rule.</td></tr>
</tbody></table>
</div>
<p>All targets must have the same set of static stems (i.e. stems with no <code>*</code> in its name).</p>
<p>Matching is done by first trying to match static targets (i.e. which are not star) then star targets.
The first match will provide the associated stem definitions and flags.</p>
<p>Unless the <code>top</code> flag is set, the pattern is rooted to the sub-repo if the rule is defined in such a sub-repo.
If the <code>top</code> flag is set, the pattern is always rooted at the top-level repo.</p>
<p>Notes:</p>
<ul>
<li>(1): In that case, such targets are not unlinked before execution.
However, if targets have non-targets hard links and are not read-only, they are uniquified, i.e. they are copied in place to ensure modification to such targets do not alter other links.
It is the user responsibility to ensure that any previous content will lead to a correct result.</li>
<li>(2): Open-lmake will try to find an alternative rule.
If none apply or otherwise do not generate this target, then the target is non-buildable.
This is equivalent to being a star target, except that there is no star stem.</li>
<li>(3): For star targets, all matching files are deemed generated and no alternative rule s searched to produce the file.</li>
</ul>
<p>Usage notes:</p>
<ul>
<li>The <code>incremental</code> flag may be used in situation where a target acts as a cache.
The target could be unlinked, but the job is substantially faster if it not and the result is always correct.
For Example, a job could call another build-system and the user is confident that such other build-system is correct.</li>
<li>The <code>optional</code> flag is used when, depending on the content of the deps, a target may or may not be produced.</li>
<li>The <code>phony</code> flag is typically used when a target acts as a symbolique name to mean that some action has been carried out.
It could be for example the target <code>ALL</code>, so that <code>lmake ALL</code> rebuilds everything while no actual file named <code>ALL</code> exists on disk.</li>
<li>The <code>-no_star</code> flag is used to avoid repetition, as it is generally possible to mention all the flags that must apply to a target,
possibly duplicating flags mentioned in other matching entries (<code>side_deps</code> and <code>side_targets</code>).</li>
<li>The <code>top</code> flag is used in case of sub-repo, which is an experimental feature.</li>
</ul>
<h3 id="timeout"><a class="header" href="#timeout"><a href="unit_tests/wine.html#:~:text=timeout%20%3D%20120"><code>timeout</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>float</code></td><td>no timeout</td><td>Full</td><td></td></tr>
</tbody></table>
</div>
<p>When this attribute has a non-zero value, job is killed and a failure is reported if it is not done before that many seconds.</p>
<h3 id="tmp_view"><a class="header" href="#tmp_view"><a href="unit_tests/overlay.html#:~:text=tmp%5Fview%20%3D%20%27%2Ftmp"><code>tmp_view</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>f-str</code></td><td><code>None</code></td><td>Full</td><td><code>'/tmp'</code></td></tr>
</tbody></table>
</div>
<p>This attribute defines the name which the temporary dir available for job execution is mounted on (cf. <a href="namespaces.html">namespaces</a>).</p>
<p>If <code>None</code>, <code>''</code> or not specified, this dir is not mounted, else, it must be an absolute path.
If view already exists, it must be (preferably empty) dir, else it must be a top-level name (e.g <code>/a</code> but not <code>/a/b</code>).</p>
<h3 id="use_script"><a class="header" href="#use_script"><a href="unit_tests/use_script.html#:~:text=use%5Fscript%20%3D%20True"><code>use_script</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>python</td><td><code>bool</code></td><td><code>False</code></td><td>Full</td><td><code>True</code></td></tr>
</tbody></table>
</div>
<p>This attribute commands an implementation detail.</p>
<p>If false, jobs are run by launching the interpreter followed by <code>-c</code> and the command text.</p>
<p>If true, jobs are run by creating a temporary file containing the command text, then by launching the interpreter followed by said file name.</p>
<p>If the size of the command text is too large to fit in the command line, this attribute is silently forced to true.</p>
<p>This attribute is typically use with interpreters that do not implement the <code>-c</code> option.</p>
<h3 id="views"><a class="header" href="#views"><a href="unit_tests/overlay.html#:~:text=views%20%3D%20%7B%20%27read%5Fwrite%27%20%3A%20%7B%27upper%27%3A%27write%27%2C%27lower%27%3A%27read%27%7D%20%7D%20%23%20mount%20read%5Fwrite%20as%20write%20on%20top%20of%20read"><code>views</code></a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>Combined</td><td><code>dict</code></td><td><code>{}</code></td><td>Full</td><td></td></tr>
</tbody></table>
</div>
<p>This attribute defines a mapping from logical views to physical dirs.</p>
<p>Accesses to logical views are mapped to their corresponding physical (non-recursively) location before any chroot if asked to do so.
Views and physical locations must be dirs.</p>
<p>Both logical views and physical locations may be local to the repo, within tmp dir or external, but it is not possible to map a local location to an external view (cf. <a href="namespaces.html">namespaces</a>).</p>
<p>Dirs in the repo or tmp are created as needed.
External views must pre-exist or be top-level names (e.g <code>/a</code> but not <code>/a/b</code>).</p>
<p>Physical description may be :</p>
<ul>
<li>a <code>f-str</code> in which case a bind mount is performed.</li>
<li>a <code>dict</code> with keys <code>upper</code> (a <code>f-str</code>) and <code>lower</code> (a single <code>f-str</code> or a list of <code>f-str</code>) in which case an overlay mount is performed.
Key <code>copy_up</code> (a single <code>f-str</code> or a list of <code>f-str</code>) may also be used to provide a list of dirs to create in <code>upper</code> or files to copy from <code>lower</code> to <code>upper</code>.
Dirs are recognized when they end with <code>/</code>.
Such <code>copy_up</code> items are provided relative to the root of the view.</li>
</ul>
<h3 id="virtual"><a class="header" href="#virtual"><code>virtual</code></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Inheritance</th><th>Type</th><th>Default</th><th>Dynamic</th><th>Example</th></tr></thead><tbody>
<tr><td>None</td><td><code>bool</code></td><td><code>False</code></td><td>No</td><td><code>True</code></td></tr>
</tbody></table>
</div>
<p>When this attribute is true, this <code>class</code> is not a rule even if it has the required target &amp; cmd attributes.
In that case, it is only used as a base class to define other rules.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="config.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="execution.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="config.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="execution.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
