<!-- Creator     : groff version 1.23.0 -->
<!-- CreationDate: Sun Apr 20 11:46:58 2025 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>LCHECK_DEPS</title>

</head>
<body>

<h1 align="center">LCHECK_DEPS</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#CAVEAT">CAVEAT</a><br>
<a href="#NOTES">NOTES</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#COPYRIGHT">COPYRIGHT</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">lcheck_deps -
ensure deps collected so far in a <i>open-lmake</i> job are
up-to-date</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>



<p style="margin-left:9%; margin-top: 1em"><b>lcheck_deps</b>
[<i>OPTION</i>]... [<i>FILE</i>]...</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>



<p style="margin-left:9%; margin-top: 1em"><b>lcheck_deps</b>
ensures that all deps accessed so far are up-to-date. If
this not the case, the job is killed, generating a rerun
report, the deps are rebuilt and the job is rerun.</p>

<p style="margin-left:9%; margin-top: 1em">This is useful
before starting a heavy computation. Typically, deps are
computed and accessed before the heavy sequence and calling
<b>check_deps</b> allows to avoid running a heavy
computation with bad inputs. It is not a semantic problem as
<i>open-lmake</i> will realize the situation, rebuild the
deps and rerun the job, but it may be a performance
problem.</p>

<p style="margin-left:9%; margin-top: 1em">Imagine for
exemple that you have to compile <i>heavy.c</i> that
includes a file <i>generated.h</i> generated by the command
<i>generator</i>. Imagine then that you type <b>lmake
generated.h</b>, you look at it, find that the file is
syntactically correct but contains a bug. You then modify
<i>generator</i> and because you are confident in your
modification, you type <b>lmake heavy.o</b>.</p>

<p style="margin-left:9%; margin-top: 1em">OpenLMake will
run the compilation of <i>heavy.o</i>, which lasts 10
minutes and discover that you need <i>generated.h</i>, which
is out-of-date. It will then rebuild <i>generated.h</i> and
rerun the compilation to <i>heavy.o</i>, another 10
minutes.</p>

<p style="margin-left:9%; margin-top: 1em">Suppose now that
your compilation script separates the preprocessor (say 10
secondes) phase from the compilation (10 minutes) phase and
call <b>lcheck_deps</b> inbetween. In that case, the first
run will stop after preprocessing as <b>lcheck_deps</b> will
kill the job at that moment and the overall time will be 10
minutes 10 secondes instead of 20 minutes.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>



<p style="margin-left:9%; margin-top: 1em"><b>-s</b>,<b>--sync</b></p>

<p style="margin-left:18%;">wait for server answer rather
than letting job go speculatively while it is interrogated.
return code will be 1 if at least one dep is in error. This
is necessary, even without checking return code, to ensure
that after this call, the directories of previous deps
actually exist if such deps are not read (such as with
<b>lmake.depend</b>).</p>

<h2>CAVEAT
<a name="CAVEAT"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">If used in
conjonction with the <b>kill_sigs</b> attribute with a
handler to manage the listed signal(s) (typically using
<b>trap ... SIG</b> and without the <b>--sync</b> option, it
may be that the command following the call to
<b>lcheck_deps</b> does not see the signal. This is due to a
race condition in <i>bash</i> when command is just
starting.</p>

<p style="margin-left:9%; margin-top: 1em">This may be
annoying if said command was supposed to do some clean up or
if it is very long. The solution in this case is to pass the
<b>--sync</b> option to <b>lcheck_deps</b>. This has a small
cost in the general case where deps are actually up-to-date,
but provides a reliable way to kill the job as
<b>lcheck_deps</b> will still be running when signal fires
up.</p>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">This is a
(performance) problem only during the first run of
<i>heavy.o</i>. On subsequent runs, in particular during a
typical edit-compile-debug loop, <i>open-lmake</i> will know
the dependencies and will launch jobs in the proper order.
But during the first run, it has no knowledge that
<i>heavy.c</i> actually includes <i>generated.h</i>.</p>

<p style="margin-left:9%; margin-top: 1em">Most often, when
<i>generated.h</i> is out-of-date, it is syntactically
incorrect (for example it does not exist), so the first run
fails quite early (without spending its heavy optimization
time).</p>

<p style="margin-left:9%; margin-top: 1em">In the case
where <i>generated.h</i> is rebuilt identically to its
previous content, there will be no second run without
<b>lcheck_deps</b> call, so <b>lcheck_deps</b> has a (minor)
adverse effect leading to an overall time of 10 minutes 10
seconds instead of 10 minutes.</p>

<p style="margin-left:9%; margin-top: 1em">Despite these
remarks, there are case where <b>lcheck_deps</b> is very
welcome.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:9%; margin-top: 1em"><b>lautodep</b>(1),
<b>ldebug</b>(1), <b>ldecode</b>(1), <b>ldepend</b>(1),
<b>lencode</b>(1), <b>lforget</b>(1), <b>lmake</b>(1),
<b>lmark</b>(1), <b>lrepair</b>(1), <b>lrun_cc</b>(1),
<b>lshow</b>(1), <b>ltarget</b>(1), <b>xxhsum</b>(1)</p>

<p style="margin-left:9%; margin-top: 1em">The python
module <b>lmake</b>.</p>

<p style="margin-left:9%; margin-top: 1em">The full
<i>open-lmake</i> documentation in
<i>&lt;open-lmake-installation-dir&gt;/docs/index.html</i>.</p>

<h2>COPYRIGHT
<a name="COPYRIGHT"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">Copyright &copy;
2023-2025, Doliam. This file is part of
<i>open-lmake</i>.</p>


<p style="margin-left:9%; margin-top: 1em"><i>open-lmake</i>
is free software; you can redistribute it and/or modify it
under the terms of the GNU General Public License as
published by the Free Software Foundation, version 3 of the
License.</p>


<p style="margin-left:9%; margin-top: 1em"><i>open-lmake</i>
is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.</p>

<p style="margin-left:9%; margin-top: 1em">You should have
received a copy of the GNU General Public License along with
this program. If not, see
<i>http://www.gnu.org/licenses/</i>.</p>
<hr>
</body>
</html>
